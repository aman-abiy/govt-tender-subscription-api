"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const dotenv_1 = __importDefault(require("dotenv"));
const xss_clean_1 = __importDefault(require("xss-clean"));
const helmet_1 = __importDefault(require("helmet"));
const express_mongo_sanitize_1 = __importDefault(require("express-mongo-sanitize"));
const db_config_1 = __importDefault(require("./config/db.config"));
const error_handler_1 = __importDefault(require("./utils/error_handler"));
const error_response_1 = __importDefault(require("./utils/error_response"));
const auth_1 = __importDefault(require("./routes/auth"));
const tender_1 = __importDefault(require("./routes/tender"));
const subscription_1 = __importDefault(require("./routes/subscription"));
const alert_1 = __importDefault(require("./routes/alert"));
const language_1 = __importDefault(require("./routes/language"));
const region_1 = __importDefault(require("./routes/region"));
const country_1 = __importDefault(require("./routes/country"));
const tender_sources_1 = __importDefault(require("./routes/tender_sources"));
const category_1 = __importDefault(require("./routes/category"));
const account_1 = __importDefault(require("./routes/account"));
const bookmarked_tender_1 = __importDefault(require("./routes/bookmarked_tender"));
const bank_1 = __importDefault(require("./routes/bank"));
const currency_1 = __importDefault(require("./routes/currency"));
const payment_1 = __importDefault(require("./routes/payment"));
const payment_method_1 = __importDefault(require("./routes/payment_method"));
const subscription_plan_1 = __importDefault(require("./routes/subscription_plan"));
const email_result_1 = __importDefault(require("./routes/email_result"));
const company_1 = __importDefault(require("./routes/company"));
const company_info_1 = __importDefault(require("./routes/company_info"));
const commission_1 = __importDefault(require("./routes/commission"));
const stats_1 = __importDefault(require("./routes/stats"));
const advertisement_1 = __importDefault(require("./routes/advertisement"));
const ad_impressions_1 = __importDefault(require("./routes/ad_impressions"));
const firebase_notification_1 = __importDefault(require("./routes/firebase_notification"));
const email_promo_1 = __importDefault(require("./routes/email_promo"));
const backup_1 = __importDefault(require("./routes/backup"));
const statics_config_1 = require("./config/statics.config");
// dotenv.config({ path: `${__dirname}/config/server.config.env` });
// dotenv.config({ path: `${__dirname}/config/keys.config.env` });
// dotenv.config({ path: `${__dirname}/config/scrapper.config.env` });
// dotenv.config({ path: `${__dirname}/config/dir.config.env` });
// dotenv.config({ path: './config/config.env' });
dotenv_1.default.config({ path: `${__dirname}/config/config.env` });
(0, db_config_1.default)();
const app = (0, express_1.default)();
app.use(express_1.default.json());
// security packages
app.use((0, xss_clean_1.default)());
app.use((0, helmet_1.default)());
app.use((0, express_mongo_sanitize_1.default)());
// serving static files
app.use('/invoice', express_1.default.static(statics_config_1.INVOICE_DIR));
app.use('/advertisements', express_1.default.static(statics_config_1.ADVERTISEMENT_DIR));
app.use('/tender_imgs', express_1.default.static(statics_config_1.TENDER_IMGS_DIR));
// handle CORS
app.use((req, res, next) => {
    res.setHeader('Access-Control-Allow-Origin', '*');
    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, PATCH, DELETE');
    res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
    next();
});
app.use(`/api/${process.env.VERSION}/auth`, auth_1.default);
app.use(`/api/${process.env.VERSION}/tender`, tender_1.default);
app.use(`/api/${process.env.VERSION}/subscription`, subscription_1.default);
app.use(`/api/${process.env.VERSION}/alert`, alert_1.default);
app.use(`/api/${process.env.VERSION}/language`, language_1.default);
app.use(`/api/${process.env.VERSION}/region`, region_1.default);
app.use(`/api/${process.env.VERSION}/country`, country_1.default);
app.use(`/api/${process.env.VERSION}/tenderSource`, tender_sources_1.default);
app.use(`/api/${process.env.VERSION}/category`, category_1.default);
app.use(`/api/${process.env.VERSION}/account`, account_1.default);
app.use(`/api/${process.env.VERSION}/bookmarkTender`, bookmarked_tender_1.default);
app.use(`/api/${process.env.VERSION}/bank`, bank_1.default);
app.use(`/api/${process.env.VERSION}/currency`, currency_1.default);
app.use(`/api/${process.env.VERSION}/payment`, payment_1.default);
app.use(`/api/${process.env.VERSION}/paymentMethod`, payment_method_1.default);
app.use(`/api/${process.env.VERSION}/subscriptionPlan`, subscription_plan_1.default);
app.use(`/api/${process.env.VERSION}/emailResults`, email_result_1.default);
app.use(`/api/${process.env.VERSION}/company`, company_1.default);
app.use(`/api/${process.env.VERSION}/companyInfo`, company_info_1.default);
app.use(`/api/${process.env.VERSION}/commissions`, commission_1.default);
app.use(`/api/${process.env.VERSION}/stats`, stats_1.default);
app.use(`/api/${process.env.VERSION}/advertisements`, advertisement_1.default);
app.use(`/api/${process.env.VERSION}/adImpressions`, ad_impressions_1.default);
app.use(`/api/${process.env.VERSION}/firebase`, firebase_notification_1.default);
app.use(`/api/${process.env.VERSION}/promoEmail`, email_promo_1.default);
app.use(`/api/${process.env.VERSION}/backup`, backup_1.default);
app.use((req, res, next) => {
    console.log('404 - req.url ', req.method, req.url);
    return next(new error_response_1.default(`404! Nothing Found! | url - '${req.url}' : method - '${req.method}'`, 404));
});
app.use(error_handler_1.default);
app.listen(process.env.PORT || 8080);
